{% extends 'base.html' %}
{% block content %}
<h1>{{ lesson.title }}</h1>
<p>{{ lesson.content }}</p>

{% if user.is_authenticated and user.student_profile %}
<h3>Сдача домашнего задания:</h3>
{% if submission %}
<p><strong>Ваше задание:</strong> {{ submission.content }}</p>
<p><strong>Оценка:</strong> {% if submission.is_graded %}{{ submission.grade }}{% else %}Не оценено{% endif %}</p>
{% if submission and submission.student.user == user %}
    <form method="post" action="{% url 'submission_delete' submission.id %}" class="d-inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-danger">Удалить отправку</button>
    </form>
{% endif %}
{% endif %}

<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Отправить</button>
</form>
{% endif %}

{% if user == lesson.course.teacher %}
<h3>Домашние задания студентов:</h3>
<ul class="list-group">
    {% for hw in lesson.submissions.all %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ hw.student.user.get_full_name|default:hw.student.user.username }}
        <a href="{% url 'grade_submission' hw.id %}" class="btn btn-sm btn-success">Оценить</a>
    </li>
    {% empty %}
    <p>Заданий пока нет.</p>
    {% endfor %}
</ul>
{% endif %}

<h3>Дедлайны урока:</h3>
{% if lesson.deadlines.all %}
<ul class="list-group mb-3">
    {% for dl in lesson.deadlines.all %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
            <strong>{{ dl.title }}</strong>
            <div class="small text-muted">До: {{ dl.due_at|date:'SHORT_DATETIME_FORMAT' }}</div>
            <div class="small">{{ dl.description }}</div>
        </div>
        {% if user == lesson.course.teacher %}
        <div>
            <a href="{% url 'deadline_edit' dl.id %}" class="btn btn-sm btn-secondary">Изменить</a>
            <a href="{% url 'deadline_delete' dl.id %}" class="btn btn-sm btn-danger">Удалить</a>
        </div>
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>Дедлайнов пока нет.</p>
{% endif %}

{% if user == lesson.course.teacher %}
<a href="{% url 'deadline_create' lesson.id %}" class="btn btn-sm btn-primary">Добавить дедлайн</a>
{% endif %}
{% endblock %}
